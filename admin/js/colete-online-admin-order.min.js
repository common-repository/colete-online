"use strict";function _createForOfIteratorHelper(e,n){var o;if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(o=_unsupportedIterableToArray(e))||n&&e&&"number"==typeof e.length){o&&(e=o);var t=0,n=function(){};return{s:n,n:function(){return t>=e.length?{done:!0}:{done:!1,value:e[t++]}},e:function(e){throw e},f:n}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var r,i=!0,c=!1;return{s:function(){o=e[Symbol.iterator]()},n:function(){var e=o.next();return i=e.done,e},e:function(e){c=!0,r=e},f:function(){try{i||null==o.return||o.return()}finally{if(c)throw r}}}}function _unsupportedIterableToArray(e,n){if(e){if("string"==typeof e)return _arrayLikeToArray(e,n);var o=Object.prototype.toString.call(e).slice(8,-1);return"Map"===(o="Object"===o&&e.constructor?e.constructor.name:o)||"Set"===o?Array.from(e):"Arguments"===o||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(o)?_arrayLikeToArray(e,n):void 0}}function _arrayLikeToArray(e,n){(null==n||n>e.length)&&(n=e.length);for(var o=0,t=new Array(n);o<n;o++)t[o]=e[o];return t}!function(N){function o(e){e=N(e);0<e.find(".coleteonline-invalid").length?N(e).find(".coleteonline-do-fetch-services-list").prop("disabled",!0):N(e).find(".coleteonline-do-fetch-services-list").prop("disabled",!1)}function n(e){var n=N(e.target),e=+n.val();isNaN(e)||e<0?N(n).addClass("coleteonline-invalid"):N(n).removeClass("coleteonline-invalid"),o()}function d(e){return{repaymentAmount:+e.find("#coleteonline-repayment-amount").val(),insuranceAmount:+e.find("#coleteonline-insurance-amount").val(),openAtDelivery:e.find("#coleteonline-open-package").is(":checked")}}function t(e){var P=N(e),i=P.find(".coleteonline-packages-table").ColeteOnlineProductTable();function j(e,n){if("ServerError"!==e.error&&"Error"!==e.error||P.find(n).html('<div class="coleteonline-notice-error">\n            '.concat(e.message,"\n          </div>")),"BadRequestError"===e.error){var o="";if(e.validationErrors){var t,o="<ul>",r=_createForOfIteratorHelper(e.validationErrors);try{for(r.s();!(t=r.n()).done;){var i=t.value;o+="<li>".concat(i.field," - ").concat(i.message,"</li>")}}catch(e){r.e(e)}finally{r.f()}o+="</ul>"}P.find(n).html('<div class="coleteonline-notice-error">\n            '.concat(e.message,"\n            ").concat(o,"\n          </div>"))}}function c(r){r.find(".coleteonline-file-download-loading").hide(),r.find(".coleteonline-do-download-awb").click(function(t){r.find(".coleteonline-file-download-loading").show(),r.find(".coleteonline-do-download-awb").hide(),N.get(ajaxurl,{action:"coleteonline_get_order_label",data:{uniqueId:t.target.dataset.uniqueId,formatType:r.find("#coleteonline-format-select").val()}},function(e){e=JSON.parse(e);var n="awb_".concat(t.target.dataset.awb,"_").concat(t.target.dataset.uniqueId,".pdf"),o=e.data.length,o=new ArrayBuffer(o),o=new Uint8Array(o);o.set(e.data);e=new Blob([o],{type:"application/pdf"});window.navigator.msSaveOrOpenBlob?window.navigator.msSaveOrOpenBlob(e,n):(o=window.URL.createObjectURL(e),(e=document.createElement("a")).href=o,e.download=n,document.body.appendChild(e),e.click(),document.body.removeChild(e)),r.find(".coleteonline-file-download-loading").hide(),r.find(".coleteonline-do-download-awb").show()})})}null==i||null!==(e=i[0])&&void 0!==e&&e.subscribe("validityChanges",function(){o(P)}),P.find("#coleteonline-repayment-amount, #coleteonline-insurance-amount").change(n),P.find("#coleteonline-repayment-amount, #coleteonline-insurance-amount").trigger("change"),P.find(".coleteonline-change-address").click(function(){P.find(".coleteonline-address-select-wrapper").show(),N.post(ajaxurl,{action:"coleteonline_get_all_addresses"},function(t){t=JSON.parse(t);for(var e=P.find("#coleteonline-address-select"),n=[],o=0;o<t.addresses.length;++o){var r=t.addresses[o];n.push(new Option(r.shortName+" - "+r.address,r.id,!1,!1))}e.append(n),t.selected&&e.val(t.selected),N(e).on("select2:select",function(n){var e,o=t.addresses.find(function(e){return+e.id==+n.params.data.id});void 0!==o&&(e=o.addressObject,N(".coleteonline-address-short-name").html("<b>".concat(e.shortName,"</b>")),N(".coleteonline-address-name").text(e.contact.name),N(".coleteonline-address-company").text(e.contact.company||""),N(".coleteonline-address-phone").html("".concat(e.contact.phone,"\n                ").concat(e.contact.phone2?"<br> "+e.contact.phone2:"")),N(".coleteonline-address-city-county").text("".concat(e.address.city,", ").concat(e.address.county)),N(".coleteonline-address-street-number").text("".concat(e.address.street,", ").concat(e.address.number)),N(".coleteonline-address-postal-country").text("".concat(e.address.postalCode,", ").concat(e.address.countryCode)),o=[e.address.building,e.address.entrance,e.address.floor,e.address.intercom,e.address.entrance,e.address.apartment].filter(function(e){return e}).join(", "),N(".coleteonline-address-other-data").text(o),N(".coleteonline-address-landmark").text(e.address.landmark||""),N(".coleteonline-address-additional-info").text(e.address.additionalInfo||""),N(".coleteonline-address-table").attr("data-address-id",e.locationId))})})}),P.find(".coleteonline-do-create-courier-order").prop("disabled",!0),P.find(".coleteonline-couriers-offers").hide(),P.find(".coleteonline-offers-loading").hide(),P.find(".coleteonline-do-fetch-services-list").click(function(){P.find(".coleteonline-show-offers-errors").empty(),P.find(".coleteonline-show-order-errors").empty(),P.find(".coleteonline-couriers-offers").show(),P.find(".coleteonline-offers-loading").show(),P.find(".coleteonline-do-fetch-services-list").hide(),P.find(".coleteonline-couriers-offers").find("tbody").empty();var e=P.find(".coleteonline-address-table")[0].dataset.addressId;N.post(ajaxurl,{action:"coleteonline_get_services_list",data:{orderId:N("#coleteonline_order_shipping_wrapper")[0].dataset.orderId,fromAddressId:e,packages:i[0].getPackagesTotals(),packageType:N("#coleteonline-order-package-type").val(),extraOptions:d(P)}},function(e){var n;if(N(".coleteonline-offers-loading").hide(),N(".coleteonline-do-fetch-services-list").show(),(e=JSON.parse(e)).error)j(e,".coleteonline-show-offers-errors");else{var o,t=[],r=[],i=[],c=[],d=_createForOfIteratorHelper(null===e||void 0===e?void 0:e.list);try{for(d.s();!(o=d.n()).done;)(function(){var n=o.value;t.includes(n.service.id)||(t.push(n.service.id),n.service.shippingPoint?(n.service.shippingPoints=e.list.filter(function(e){return n.service.id===e.service.id}).map(function(e){return{shippingPoint:e.service.shippingPoint,activationId:e.service.activationId}}),i.push(n)):n.service.fixedLocationsFrom?c.push(n):r.push(n))})()}catch(e){d.e(e)}finally{d.f()}console.log("display list",[]);var a=null===(n=P.find(".coleteonline-couriers-offers")[0].dataset)||void 0===n?void 0:n.selectedCourierId,l=null===(n=P.find(".coleteonline-couriers-offers")[0].dataset)||void 0===n?void 0:n.selectedShippingPointId;r.length&&P.find(".coleteonline-couriers-offers").find("tbody").append('\n              <tr class="bg-gray-100">\n                <td colspan="4" class="full-width text-center padding-bottom-1 border-bottom-black">\n                  <b class="vertical-align-middle">Address to address services</b>\n                </td>\n              </tr>\n            ');for(var s=0,f=r;s<f.length;s++){var p=f[s],p='\n              <tr class="'.concat(+a==+p.service.id?"coleteonline-selected-by-client":"",'">\n                <td>\n                  <input type="checkbox"\n                    class="coleteonline-selected-courier"\n                    data-courier-id=').concat(p.service.id,"\n                    ").concat(+a==+p.service.id?"checked":"","\n                  >\n                </td>\n                <td>").concat(p.service.courierName,"</td>\n                <td>").concat(p.service.name,"</td>\n                <td><b>").concat(p.price.total," ron</b><br>\n                    (").concat(p.price.noVat," ron + TVA)\n                </td>\n              </tr>\n            ");P.find(".coleteonline-couriers-offers").find("tbody").append(p)}i.length&&P.find(".coleteonline-couriers-offers").find("tbody").append('\n              <tr class="bg-gray-100">\n                <td colspan="4" class="full-width text-center padding-bottom-1 border-bottom-black">\n                  <b class="vertical-align-middle">Address to locker services</b>\n                </td>\n              </tr>\n            ');for(var u=0,v=i;u<v.length;u++){var h,g=v[u],b='\n              <tr class="'.concat(+a==+g.service.id?"coleteonline-selected-by-client":"",'">\n                <td>\n                  <input type="checkbox"\n                    class="coleteonline-selected-courier"\n                    data-courier-id=').concat(g.service.id,"\n                    ").concat(+a==+g.service.id?"checked":"","\n                  >\n                </td>\n                <td>").concat(g.service.courierName,"</td>\n                <td>").concat(g.service.name,"</td>\n                <td><b>").concat(g.price.total," ron</b><br>\n                    (").concat(g.price.noVat," ron + TVA)\n                </td>\n              </tr>\n            "),m="",y=_createForOfIteratorHelper(g.service.shippingPoints);try{for(y.s();!(h=y.n()).done;){var w=h.value;m+="\n                <option ".concat(+w.shippingPoint.id==+l?"selected":"",' value="').concat(w.shippingPoint.id,'">\n                  ').concat(w.shippingPoint.name,"\n                </option>\n              ")}}catch(e){y.e(e)}finally{y.f()}b+='\n              <tr>\n                <td colspan="4">\n                  <select class="full-width to-sp-sel-service-id-'.concat(g.service.id,'">\n                    ').concat(m,"\n                  </select>\n                </td>\n              </tr>\n            "),P.find(".coleteonline-couriers-offers").find("tbody").append(b)}c.length&&P.find(".coleteonline-couriers-offers").find("tbody").append('\n              <tr class="bg-gray-100">\n                <td colspan="4" class="full-width text-center padding-bottom-1 border-bottom-black">\n                  <b class="vertical-align-middle">Locker to address services</b>\n                </td>\n              </tr>\n            ');for(var _=0,k=c;_<k.length;_++){var I,x=k[_],O='\n              <tr class="'.concat(+a==+x.service.id?"coleteonline-selected-by-client":"",'">\n                <td>\n                  <input type="checkbox"\n                    class="coleteonline-selected-courier"\n                    data-courier-id=').concat(x.service.id,"\n                    ").concat(+a==+x.service.id?"checked":"","\n                  >\n                </td>\n                <td>").concat(x.service.courierName,"</td>\n                <td>").concat(x.service.name,"</td>\n                <td><b>").concat(x.price.total," ron</b><br>\n                    (").concat(x.price.noVat," ron + TVA)\n                </td>\n              </tr>\n            "),A="",S=_createForOfIteratorHelper(x.service.fixedLocationsFrom);try{for(S.s();!(I=S.n()).done;){var T=I.value;A+="\n                <option ".concat(+T.id==+l?"selected":"",' value="').concat(T.id,'">\n                  ').concat(T.name,"\n                </option>\n              ")}}catch(e){S.e(e)}finally{S.f()}O+='\n              <tr>\n                <td colspan="4">\n                  <select class="full-width from-sp-sel-service-id-'.concat(x.service.id,'"">\n                    ').concat(A,"\n                  </select>\n                </td>\n              </tr>\n            "),P.find(".coleteonline-couriers-offers").find("tbody").append(O)}P.find(".coleteonline-selected-courier:checked").length&&P.find(".coleteonline-do-create-courier-order").prop("disabled",!1),P.find(".coleteonline-selected-courier").unbind("change"),P.find(".coleteonline-selected-courier").change(function(e){P.find(".coleteonline-selected-courier").prop("checked",!1),P.find(e.target).prop("checked",!0),P.find(".coleteonline-do-create-courier-order").prop("disabled",!1)})}})}),P.find(".coleteonline-orders-loading").hide(),P.find(".coleteonline-do-create-courier-order").click(function(){P.find(".coleteonline-show-offers-errors").empty(),P.find(".coleteonline-show-order-errors").empty(),P.find(".coleteonline-orders-loading").show(),P.find(".coleteonline-do-create-courier-order").hide();var e=P.find(".coleteonline-address-table")[0].dataset.addressId,n=P.find(".coleteonline-selected-courier:checked")[0].dataset.courierId,o=P[0].dataset.shippingOrderKey,t=null===(r=P.find(".to-sp-sel-service-id-"+n))||void 0===r?void 0:r.val(),r=null===(r=P.find(".from-sp-sel-service-id-"+n))||void 0===r?void 0:r.val();N.post(ajaxurl,{action:"coleteonline_create_courier_order",data:{orderId:N("#coleteonline_order_shipping_wrapper")[0].dataset.orderId,fromAddressId:e,shippingOrderKey:o,packages:i[0].getPackagesTotals(),packageType:N("#coleteonline-order-package-type").val(),content:P.find(".coleteonline-order-content-input").val(),selectedCourierId:n,selectedToShippingPointId:t,selectedFromShippingPointId:r,extraOptions:d(P)}},function(e){N(".coleteonline-orders-loading").hide(),N(".coleteonline-do-create-courier-order").show(),(e=JSON.parse(e)).error?j(e,".coleteonline-show-order-errors"):(e=N(e.fragments.courierOrders),P.replaceWith(e),c(e))})}),c(P)}N(".order").each(function(e,n){t(n)}),function o(){N(".do-add-extra-order").click(function(){N.post(ajaxurl,{action:"coleteonline_add_extra_courier_order",data:{orderId:N("#coleteonline_order_shipping_wrapper")[0].dataset.orderId}},function(e){var n;(e=JSON.parse(e)).error||(N(".do-add-extra-order").parent().remove(),e=(n=N(e.fragments.extraOrder)).find(".order"),n=n.find(".add-extra-orders"),N("#coleteonline_order_shipping_wrapper").append(e),n.length&&N("#coleteonline_order_shipping_wrapper").append(n),t(e),o())})})}()}(jQuery);